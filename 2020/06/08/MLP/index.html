
<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  
  <title>MLP | Study notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1. Intuition 1. Linear binary classification Features: (\(x_1,x_2\)) Target: \(y\in \{1,-1\}\) Decision function (distance to the boundary): \(d(x)&#x3D;w_0+w_1x_1+w_2x_2\) Algorithm: \(a(x)&#x3D;sign(d(x))\) 2">
<meta property="og:type" content="article">
<meta property="og:title" content="MLP">
<meta property="og:url" content="http://sunyinge.github.io/2020/06/08/MLP/index.html">
<meta property="og:site_name" content="Study notes">
<meta property="og:description" content="1. Intuition 1. Linear binary classification Features: (\(x_1,x_2\)) Target: \(y\in \{1,-1\}\) Decision function (distance to the boundary): \(d(x)&#x3D;w_0+w_1x_1+w_2x_2\) Algorithm: \(a(x)&#x3D;sign(d(x))\) 2">
<meta property="og:image" content="http://sunyinge.github.io/images/triangle.png">
<meta property="og:image" content="http://sunyinge.github.io/images/compgraph.png">
<meta property="og:image" content="http://sunyinge.github.io/images/cg.png">
<meta property="og:image" content="http://sunyinge.github.io/images/dcg.png">
<meta property="og:image" content="http://sunyinge.github.io/images/bp1.png">
<meta property="og:image" content="http://sunyinge.github.io/images/bp2.png">
<meta property="og:image" content="http://sunyinge.github.io/images/compgraph.png">
<meta property="article:published_time" content="2020-06-08T14:16:30.000Z">
<meta property="article:modified_time" content="2020-06-08T19:10:56.570Z">
<meta property="article:author" content="Yinge Sun">
<meta property="article:tag" content="DL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://sunyinge.github.io/images/triangle.png">
  
    <link rel="alternative" href="/atom.xml" title="Study notes" type="application/atom+xml">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
  

<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <nav id="upper-nav" class="inner">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <div class="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        
          <a id="nav-github" class="nav-icon" href="https://github.com/sunyinge" target="_blank" rel="noopener"></a>
        
      </div>
    </nav>
    <div id="header-title">
      
        <h1 id="blog-title-wrap">
          <a href="/" id="blog-title">Study notes</a>
        </h1>
      
    </div>
    <div id="contenedor">
      <ul class="cube">
        <li class="cara">Hello!</li>
        <li class="cara"></li>
        <li class="cara"></li>
        <li class="cara"></li>
        <li class="cara"></li>
        <li class="cara"></li>
      </ul>
    </div>
    <nav id="main-nav">
      
        <a class="main-nav-link" href="/">Home</a>
      
        <a class="main-nav-link" href="/archives">Archives</a>
      
      <a class="main-nav-link st-search-show-outputs">Search</a>
    </nav>
  </div>
</header>

    <div class="outer">
      <section id="main"><article id="post-MLP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2020/06/08/MLP/" class="article-date">
  <time datetime="2020-06-08T14:16:30.000Z" itemprop="datePublished">2020-06-08</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      MLP
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h3 id="intuition">1. Intuition</h3>
<h4 id="linear-binary-classification">1. Linear binary classification</h4>
<p>Features: (<span class="math inline">\(x_1,x_2\)</span>)</p>
<p>Target: <span class="math inline">\(y\in \{1,-1\}\)</span></p>
<p>Decision function (distance to the boundary): <span class="math inline">\(d(x)=w_0+w_1x_1+w_2x_2\)</span></p>
<p>Algorithm: <span class="math inline">\(a(x)=sign(d(x))\)</span></p>
<h4 id="logistic-regression">2. Logistic regression</h4>
<p>Features: (<span class="math inline">\(x_1,x_2\)</span>)</p>
<p>Target: <span class="math inline">\(y\in \{0,1\}\)</span></p>
<p>Decision function: <span class="math inline">\(d(x)=w_0+w_1x_1+w_2x_2\)</span></p>
<p>Algorithm: <span class="math inline">\(a(x)=\sigma(d(x))\)</span>, where <span class="math inline">\(\sigma(x)=\frac{1}{1+e^{-x}}\)</span></p>
<h4 id="triangle-problem">3. Triangle problem</h4>
<p>Features: (<span class="math inline">\(x_1,x_2\)</span>)</p>
<p>Target: <span class="math inline">\(y\in \{0,1\}\)</span></p>
<p><img src="/images/triangle.png" style="zoom:40%;" /></p>
<p>A logistic regression per subproblem, and the three lines give us <strong>new features</strong> <span class="math inline">\((x_1,x_2)\rightarrow(z_1,z_2,z_3)\)</span>.</p>
<h3 id="multilayer-perceptron-mlp">2. Multilayer Perceptron (MLP)</h3>
<ul>
<li>Computation graph
<ul>
<li>Take a linear combination of inputs</li>
<li>Apply nonlinear activation function, e.g., <span class="math inline">\(\sigma(x)\)</span></li>
</ul></li>
</ul>
<p><img src="/images/compgraph.png" /></p>
<ul>
<li><p>Architecture of an MLP</p>
<ul>
<li>Number of layers</li>
<li>Number of neurons in each layer</li>
<li>Activation function</li>
</ul>
<p>A hidden layer in MLP is a dense layer or fully-connected layer.</p></li>
</ul>
<a id="more"></a>
<h3 id="how-to-train-mlp---sgd">3. How to train MLP? --SGD</h3>
<h4 id="chain-rule">1. Chain rule</h4>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/images/cg.png" /></th>
<th style="text-align: center;"><img src="/images/dcg.png" /></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><em>Computaion graph</em></td>
<td style="text-align: center;"><em>Derivatives computation graph</em></td>
</tr>
</tbody>
</table>
<ul>
<li>Derivative of node a w.r.t node b: summation of multiplied edges along each path from a to b.</li>
</ul>
<h4 id="back-propagation">2. Back-propagation</h4>
<p>Instead of finding all paths from one node to another node and doing summation, we can <strong>reuse computations from previous steps</strong> to make it fast. This is called <strong>reverse-mode differentiation</strong>, or <strong>back-propagation</strong> in neural networks. In this way, for each edge we compute its value only once and <strong>multiply by its value exactly once</strong>, as is shown by the graph below.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="/images/bp1.png" /></th>
<th style="text-align: center;"><img src="/images/bp2.png" /></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><em>Full calculation</em></td>
<td style="text-align: center;"><em>Use <span class="math inline">\(\frac{\partial p}{\partial z_1}\)</span> in calculation</em></td>
</tr>
</tbody>
</table>
<p>Inside the back-propagation, it has two passes, the <strong>forward pass</strong> and the <strong>backward pass</strong>.</p>
<ul>
<li><p>Forward pass: get the value at each node (e.g., <span class="math inline">\(z_1, h_2\)</span> in the graph above, etc) through the computation graph so that we know at which point we take derivatives.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forward_pass</span><span class="params">(inputs)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">1.</span>/(<span class="number">1</span>+np.exp(-inputs))</span><br></pre></td></tr></table></figure></li>
<li><p>Backward pass: get the derivative at each node (e.g., <span class="math inline">\(\frac{\partial L}{\partial x_1}, \frac{\partial L}{\partial z_2}\)</span> in the graph above, etc) through the derivative computation graph. We will use it to compute the gradients of loss function L w.r.t to the weights.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backward_pass</span><span class="params">(inputs,incoming_gradients)</span>:</span></span><br><span class="line">	sigmoid = <span class="number">1.</span>/(<span class="number">1</span>+np.exp(-inputs))</span><br><span class="line">	<span class="keyword">return</span> sigmoid*(<span class="number">1</span>-sigmoid)*incoming_gradients</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="matrix-representation">4. Matrix Representation</h3>
<h4 id="one-instance">1. One instance</h4>
<p><img src="/images/compgraph.png" /></p>
<p>The weight matrix between layer a and layer b has dimension <strong>num_neurons in layer a <span class="math inline">\(\times\)</span> num_neurons in layer b</strong>. For example, the weight matrix between x layer and z layer is a <span class="math inline">\(2\times 3\)</span> matrix.</p>
<ul>
<li>Forward pass:</li>
</ul>
<p><span class="math display">\[
\begin{equation*}
(x_1,x_2)\cdot
\left[
\begin{array}{ccc}
    w_{11} &amp; w_{12} &amp; w_{13}\\
    w_{21} &amp; w_{22} &amp; w_{23} \\
\end{array} \right]
=(z_1,z_2,z_3) \Leftrightarrow xW=z
\end{equation*}\\
\]</span></p>
<ul>
<li>Backward pass:</li>
</ul>
<p><span class="math display">\[
\frac{\partial L}{\partial w_{ij}}=\sum_k\frac{\partial L}{\partial z_k}\cdot\frac{\partial z_k}{\partial w_{ij}}=\frac{\partial L}{\partial z_j}\cdot x_i
\]</span></p>
<p>​ Since <span class="math inline">\(\frac{\partial L}{\partial z} = (\frac{\partial L}{\partial z_1}, \frac{\partial L}{\partial z_2}, \frac{\partial L}{\partial z_3})\)</span>, we have <span class="math display">\[
\frac{\partial L}{\partial W} = x^T\frac{\partial L}{\partial z}.
\]</span> ​ And similarly, <span class="math display">\[
\frac{\partial L}{\partial x} = \frac{\partial L}{\partial z}W^T.
\]</span></p>
<h4 id="mini-batch">2. Mini batch</h4>
<p>Say batch of 2.</p>
<ul>
<li>Forward pass:</li>
</ul>
<p><span class="math display">\[
\begin{equation*}
\left( 
\begin{array}{cc}
    x_{11} &amp; x_{12}\\
    x_{21} &amp; x_{22}\\
\end{array} \right)\cdot
\left[
\begin{array}{ccc}
    w_{11} &amp; w_{12} &amp; w_{13}\\
    w_{21} &amp; w_{22} &amp; w_{23} \\
\end{array} \right]
=\left( 
\begin{array}{ccc}
    z_{11} &amp; z_{12} &amp; z_{13}\\
    z_{21} &amp; z_{22} &amp; z_{23} \\
\end{array} \right) \Leftrightarrow XW=Z
\end{equation*}\\
\]</span></p>
<ul>
<li>Backward pass:</li>
</ul>
<p><span class="math display">\[
\frac{\partial L}{\partial w_{ij}}=\frac{\partial L(z_{11},z_{12},z_{13})}{\partial w_{ij}}+\frac{\partial L(z_{21},z_{22},z_{23})}{\partial w_{ij}}=\frac{\partial L}{\partial z_{1j}}\cdot x_{1i}+\frac{\partial L}{\partial z_{2j}}\cdot x_{2i} \\
\text{(summation over batches)}
\]</span></p>
<p>​ Since <span class="math inline">\(\frac{\partial L}{\partial z} = \left( \begin{array}{ccc} ​ \frac{\partial L}{\partial z_{11}} &amp; \frac{\partial L}{\partial z_{12}} &amp; \frac{\partial L}{\partial z_{13}}\\ ​ \frac{\partial L}{\partial z_{21}} &amp; \frac{\partial L}{\partial z_{22}} &amp; \frac{\partial L}{\partial z_{23}} \\ \end{array} \right)\)</span>, we have <span class="math display">\[
\frac{\partial L}{\partial W} = X^T\frac{\partial L}{\partial z}.
\]</span> ​ And similarly, we have <span class="math display">\[
\frac{\partial L}{\partial X} = \frac{\partial L}{\partial z}W^T.
\]</span> So,</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forward_pass</span><span class="params">(X,W)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> X.dot(X)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backward_pass</span><span class="params">(X,W,dZ)</span>:</span></span><br><span class="line">	dX = dZ.dot(W.T)</span><br><span class="line">	dW = X.T.dot(dZ)</span><br><span class="line">	<span class="keyword">return</span> dX,dW</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DL/" rel="tag">DL</a></li></ul>

        <a data-url="http://sunyinge.github.io/2020/06/08/MLP/" data-id="ckb783rrm0000cp3xeal347qs" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/06/08/Matrix-derivatives/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Matrix derivatives
        
      </div>
    </a>
  
  
    <a href="/2020/06/07/Measure-of-accuracy/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Measure of accuracy</div>
    </a>
  
</nav>

  
</article>


</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/06/08/Text-classification/">Text classification</a>
          </li>
        
          <li>
            <a href="/2020/06/08/Matrix-derivatives/">Matrix derivatives</a>
          </li>
        
          <li>
            <a href="/2020/06/08/MLP/">MLP</a>
          </li>
        
          <li>
            <a href="/2020/06/07/Measure-of-accuracy/">Measure of accuracy</a>
          </li>
        
          <li>
            <a href="/2020/06/07/Optimization/">Optimization</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/DL/" rel="tag">DL</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Installation/" rel="tag">Installation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ML/" rel="tag">ML</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NLP/" rel="tag">NLP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Optimi/" rel="tag">Optimi</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Optimization/" rel="tag">Optimization</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">6</span></li></ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Yinge Sun<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/sun11/hexo-theme-paperbox" target="_blank">Paperbox</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
  <a href="#search" class="mobile-nav-link st-search-show-outputs">Search</a>
</nav>

  
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    menuSettings: {
      zoom: "None"
    },
    showMathMenu: false,
    jax: ["input/TeX","output/CommonHTML"],
    extensions: ["tex2jax.js"],
    TeX: {
      extensions: ["AMSmath.js","AMSsymbols.js"],
      equationNumbers: {
        autoNumber: "AMS"
      }
    },
  });
</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script>



<!-- totop start -->
<div id="totop">
	<a title="To Top"></a>
</div>
<!-- totop end -->

<!-- swiftype search start -->

<!-- swiftype search end -->



<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/lrsjng.jquery-qrcode/0.12.0/jquery.qrcode.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


</div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
